{
  "query": "\nSET NAMES utf8mb4;\nSET time_zone = '+00:00';\n\n-- ─── USERS ───────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `users` (\n  `id`           INT AUTO_INCREMENT PRIMARY KEY,\n  `openId`       VARCHAR(64)  NOT NULL UNIQUE,\n  `name`         TEXT,\n  `email`        VARCHAR(320),\n  `loginMethod`  VARCHAR(64),\n  `role`         ENUM('user','admin','manager','cashier') NOT NULL DEFAULT 'user',\n  `isActive`     BOOLEAN NOT NULL DEFAULT TRUE,\n  `createdAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  `lastSignedIn` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── BRANCHES ────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `branches` (\n  `id`          INT AUTO_INCREMENT PRIMARY KEY,\n  `name`        VARCHAR(128) NOT NULL,\n  `code`        VARCHAR(16)  NOT NULL UNIQUE,\n  `address`     TEXT,\n  `phone`       VARCHAR(32),\n  `isWarehouse` BOOLEAN NOT NULL DEFAULT FALSE,\n  `isActive`    BOOLEAN NOT NULL DEFAULT TRUE,\n  `createdAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── USER-BRANCH ASSIGNMENTS ─────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `user_branches` (\n  `id`        INT AUTO_INCREMENT PRIMARY KEY,\n  `userId`    INT NOT NULL,\n  `branchId`  INT NOT NULL,\n  `createdAt` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_ub_user`   FOREIGN KEY (`userId`)   REFERENCES `users`(`id`)    ON DELETE CASCADE,\n  CONSTRAINT `fk_ub_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE CASCADE,\n  UNIQUE KEY `uq_user_branch` (`userId`, `branchId`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── CATEGORIES ──────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `categories` (\n  `id`          INT AUTO_INCREMENT PRIMARY KEY,\n  `name`        VARCHAR(128) NOT NULL,\n  `description` TEXT,\n  `createdAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── SUPPLIERS ───────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `suppliers` (\n  `id`            INT AUTO_INCREMENT PRIMARY KEY,\n  `name`          VARCHAR(128) NOT NULL,\n  `contactPerson` VARCHAR(128),\n  `phone`         VARCHAR(32),\n  `email`         VARCHAR(320),\n  `address`       TEXT,\n  `isActive`      BOOLEAN NOT NULL DEFAULT TRUE,\n  `createdAt`     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── PRODUCTS ────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `products` (\n  `id`           INT AUTO_INCREMENT PRIMARY KEY,\n  `sku`          VARCHAR(64)  NOT NULL UNIQUE,\n  `name`         VARCHAR(256) NOT NULL,\n  `description`  TEXT,\n  `categoryId`   INT,\n  `supplierId`   INT,\n  `landingCost`  DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `branchCost`   DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `retailPrice`  DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `reorderLevel` INT NOT NULL DEFAULT 5,\n  `isActive`     BOOLEAN NOT NULL DEFAULT TRUE,\n  `imageUrl`     TEXT,\n  `barcode`      VARCHAR(128),\n  `createdAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_prod_category` FOREIGN KEY (`categoryId`) REFERENCES `categories`(`id`) ON DELETE SET NULL,\n  CONSTRAINT `fk_prod_supplier` FOREIGN KEY (`supplierId`) REFERENCES `suppliers`(`id`)  ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── INVENTORY ITEMS ─────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `inventory_items` (\n  `id`                INT AUTO_INCREMENT PRIMARY KEY,\n  `serialNo`          VARCHAR(128) NOT NULL UNIQUE,\n  `batchId`           VARCHAR(64),\n  `productId`         INT NOT NULL,\n  `branchId`          INT NOT NULL,\n  `landingCost`       DECIMAL(12,2) NOT NULL,\n  `branchCost`        DECIMAL(12,2) NOT NULL,\n  `status`            ENUM('Available','Sold','InTransit','Reserved','Damaged') NOT NULL DEFAULT 'Available',\n  `transitToBranchId` INT,\n  `notes`             TEXT,\n  `createdAt`         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_inv_product` FOREIGN KEY (`productId`) REFERENCES `products`(`id`) ON DELETE CASCADE,\n  CONSTRAINT `fk_inv_branch`  FOREIGN KEY (`branchId`)  REFERENCES `branches`(`id`) ON DELETE CASCADE,\n  INDEX `idx_inv_branch` (`branchId`),\n  INDEX `idx_inv_product` (`productId`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── SALES ───────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `sales` (\n  `id`             INT AUTO_INCREMENT PRIMARY KEY,\n  `receiptNo`      VARCHAR(32) NOT NULL UNIQUE,\n  `branchId`       INT NOT NULL,\n  `userId`         INT NOT NULL,\n  `customerName`   VARCHAR(128),\n  `customerPhone`  VARCHAR(32),\n  `subtotal`       DECIMAL(12,2) NOT NULL,\n  `discount`       DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `totalAmount`    DECIMAL(12,2) NOT NULL,\n  `paymentType`    ENUM('Cash','Card','Transfer','Mixed') NOT NULL,\n  `status`         ENUM('Completed','Voided','Pending') NOT NULL DEFAULT 'Completed',\n  `notes`          TEXT,\n  `syncedAt`       TIMESTAMP,\n  `isOfflineSale`  BOOLEAN NOT NULL DEFAULT FALSE,\n  `createdAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_sale_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_sale_user`   FOREIGN KEY (`userId`)   REFERENCES `users`(`id`)    ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── SALE LINE ITEMS ─────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `sale_items` (\n  `id`              INT AUTO_INCREMENT PRIMARY KEY,\n  `saleId`          INT NOT NULL,\n  `inventoryItemId` INT NOT NULL,\n  `productId`       INT NOT NULL,\n  `serialNo`        VARCHAR(128) NOT NULL,\n  `landingCost`     DECIMAL(12,2) NOT NULL,\n  `branchCost`      DECIMAL(12,2) NOT NULL,\n  `retailPrice`     DECIMAL(12,2) NOT NULL,\n  `profit`          DECIMAL(12,2) NOT NULL,\n  `investor70`      DECIMAL(12,2) NOT NULL,\n  `master30`        DECIMAL(12,2) NOT NULL,\n  `cashDueHO`       DECIMAL(12,2) NOT NULL,\n  `createdAt`       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_si_sale` FOREIGN KEY (`saleId`) REFERENCES `sales`(`id`) ON DELETE CASCADE,\n  CONSTRAINT `fk_si_inv`  FOREIGN KEY (`inventoryItemId`) REFERENCES `inventory_items`(`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── STOCK TRANSFERS ─────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `stock_transfers` (\n  `id`                INT AUTO_INCREMENT PRIMARY KEY,\n  `transferNo`        VARCHAR(32) NOT NULL UNIQUE,\n  `fromBranchId`      INT NOT NULL,\n  `toBranchId`        INT NOT NULL,\n  `requestedByUserId` INT NOT NULL,\n  `approvedByUserId`  INT,\n  `status`            ENUM('Pending','Approved','Rejected','InTransit','Completed','Cancelled') NOT NULL DEFAULT 'Pending',\n  `notes`             TEXT,\n  `rejectionReason`   TEXT,\n  `requestedAt`       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `approvedAt`        TIMESTAMP,\n  `completedAt`       TIMESTAMP,\n  `updatedAt`         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_st_from`      FOREIGN KEY (`fromBranchId`)      REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_st_to`        FOREIGN KEY (`toBranchId`)        REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_st_req_user`  FOREIGN KEY (`requestedByUserId`) REFERENCES `users`(`id`)    ON DELETE RESTRICT,\n  CONSTRAINT `fk_st_app_user`  FOREIGN KEY (`approvedByUserId`)  REFERENCES `users`(`id`)    ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── STOCK TRANSFER ITEMS ────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `stock_transfer_items` (\n  `id`              INT AUTO_INCREMENT PRIMARY KEY,\n  `transferId`      INT NOT NULL,\n  `inventoryItemId` INT NOT NULL,\n  `serialNo`        VARCHAR(128) NOT NULL,\n  `productId`       INT NOT NULL,\n  `createdAt`       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_sti_transfer` FOREIGN KEY (`transferId`) REFERENCES `stock_transfers`(`id`) ON DELETE CASCADE,\n  CONSTRAINT `fk_sti_inv`      FOREIGN KEY (`inventoryItemId`) REFERENCES `inventory_items`(`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── LEDGER ENTRIES ──────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `ledger_entries` (\n  `id`             INT AUTO_INCREMENT PRIMARY KEY,\n  `branchId`       INT NOT NULL,\n  `entryType`      ENUM('Sale','Expense','Payment','Adjustment','Transfer','PurchasePayable') NOT NULL,\n  `referenceId`    INT,\n  `referenceType`  VARCHAR(32),\n  `description`    TEXT,\n  `debit`          DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `credit`         DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `runningBalance` DECIMAL(12,2) NOT NULL,\n  `createdAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_le_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── EXPENSES ────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `expenses` (\n  `id`          INT AUTO_INCREMENT PRIMARY KEY,\n  `branchId`    INT NOT NULL,\n  `userId`      INT NOT NULL,\n  `category`    VARCHAR(64) NOT NULL,\n  `description` TEXT,\n  `amount`      DECIMAL(12,2) NOT NULL,\n  `expenseDate` TIMESTAMP NOT NULL,\n  `createdAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_exp_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_exp_user`   FOREIGN KEY (`userId`)   REFERENCES `users`(`id`)    ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── PAYMENTS TO HEAD OFFICE ─────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `ho_payments` (\n  `id`            INT AUTO_INCREMENT PRIMARY KEY,\n  `branchId`      INT NOT NULL,\n  `userId`        INT NOT NULL,\n  `amount`        DECIMAL(12,2) NOT NULL,\n  `paymentMethod` VARCHAR(32),\n  `reference`     VARCHAR(128),\n  `notes`         TEXT,\n  `paymentDate`   TIMESTAMP NOT NULL,\n  `createdAt`     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_hop_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_hop_user`   FOREIGN KEY (`userId`)   REFERENCES `users`(`id`)    ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── BRANCH LEDGER ENTRIES ───────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `branch_ledger_entries` (\n  `id`          INT AUTO_INCREMENT PRIMARY KEY,\n  `branchId`    INT NOT NULL,\n  `saleId`      INT,\n  `type`        ENUM('stock_received','sale_profit','payment_sent','payment_received') NOT NULL,\n  `amount`      DECIMAL(12,2) NOT NULL,\n  `description` TEXT,\n  `createdAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_ble_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_ble_sale`   FOREIGN KEY (`saleId`)   REFERENCES `sales`(`id`)    ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── AUDIT TRAIL ─────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `audit_logs` (\n  `id`         BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `userId`     INT,\n  `userEmail`  VARCHAR(320),\n  `userName`   VARCHAR(128),\n  `action`     VARCHAR(64) NOT NULL,\n  `entityType` VARCHAR(64) NOT NULL,\n  `entityId`   VARCHAR(64),\n  `branchId`   INT,\n  `details`    TEXT,\n  `ipAddress`  VARCHAR(64),\n  `createdAt`  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  INDEX `idx_audit_entity` (`entityType`, `entityId`),\n  INDEX `idx_audit_user` (`userId`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── COMPANY SETTINGS ────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `company_settings` (\n  `id`              INT AUTO_INCREMENT PRIMARY KEY,\n  `companyName`     VARCHAR(256) NOT NULL DEFAULT 'AutoTools ERP',\n  `tagline`         VARCHAR(256),\n  `address`         TEXT,\n  `phone`           VARCHAR(64),\n  `email`           VARCHAR(320),\n  `website`         VARCHAR(256),\n  `currency`        VARCHAR(8) NOT NULL DEFAULT 'USD',\n  `currencySymbol`  VARCHAR(8) NOT NULL DEFAULT '$',\n  `logoUrl`         TEXT,\n  `primaryColor`    VARCHAR(32) DEFAULT '#f97316',\n  `taxRate`         DECIMAL(5,2) DEFAULT 0.00,\n  `receiptFooter`   TEXT,\n  `updatedAt`       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── CUSTOMERS ───────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `customers` (\n  `id`             INT AUTO_INCREMENT PRIMARY KEY,\n  `name`           VARCHAR(128) NOT NULL,\n  `phone`          VARCHAR(32),\n  `email`          VARCHAR(320),\n  `address`        TEXT,\n  `notes`          TEXT,\n  `totalPurchases` DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `isActive`       BOOLEAN NOT NULL DEFAULT TRUE,\n  `createdAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── REORDER ALERTS ──────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `reorder_alerts` (\n  `id`           INT AUTO_INCREMENT PRIMARY KEY,\n  `productId`    INT NOT NULL,\n  `branchId`     INT NOT NULL,\n  `currentStock` INT NOT NULL,\n  `reorderLevel` INT NOT NULL,\n  `isResolved`   BOOLEAN NOT NULL DEFAULT FALSE,\n  `resolvedAt`   TIMESTAMP,\n  `createdAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_ra_product` FOREIGN KEY (`productId`) REFERENCES `products`(`id`) ON DELETE CASCADE,\n  CONSTRAINT `fk_ra_branch`  FOREIGN KEY (`branchId`)  REFERENCES `branches`(`id`) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway04.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 48yCYyFHTgav2j9.8fd33d3537ae --database 7ZcBDNvzQVdPenBD24E82P --execute \nSET NAMES utf8mb4;\nSET time_zone = '+00:00';\n\n-- ─── USERS ───────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `users` (\n  `id`           INT AUTO_INCREMENT PRIMARY KEY,\n  `openId`       VARCHAR(64)  NOT NULL UNIQUE,\n  `name`         TEXT,\n  `email`        VARCHAR(320),\n  `loginMethod`  VARCHAR(64),\n  `role`         ENUM('user','admin','manager','cashier') NOT NULL DEFAULT 'user',\n  `isActive`     BOOLEAN NOT NULL DEFAULT TRUE,\n  `createdAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  `lastSignedIn` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── BRANCHES ────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `branches` (\n  `id`          INT AUTO_INCREMENT PRIMARY KEY,\n  `name`        VARCHAR(128) NOT NULL,\n  `code`        VARCHAR(16)  NOT NULL UNIQUE,\n  `address`     TEXT,\n  `phone`       VARCHAR(32),\n  `isWarehouse` BOOLEAN NOT NULL DEFAULT FALSE,\n  `isActive`    BOOLEAN NOT NULL DEFAULT TRUE,\n  `createdAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── USER-BRANCH ASSIGNMENTS ─────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `user_branches` (\n  `id`        INT AUTO_INCREMENT PRIMARY KEY,\n  `userId`    INT NOT NULL,\n  `branchId`  INT NOT NULL,\n  `createdAt` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_ub_user`   FOREIGN KEY (`userId`)   REFERENCES `users`(`id`)    ON DELETE CASCADE,\n  CONSTRAINT `fk_ub_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE CASCADE,\n  UNIQUE KEY `uq_user_branch` (`userId`, `branchId`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── CATEGORIES ──────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `categories` (\n  `id`          INT AUTO_INCREMENT PRIMARY KEY,\n  `name`        VARCHAR(128) NOT NULL,\n  `description` TEXT,\n  `createdAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── SUPPLIERS ───────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `suppliers` (\n  `id`            INT AUTO_INCREMENT PRIMARY KEY,\n  `name`          VARCHAR(128) NOT NULL,\n  `contactPerson` VARCHAR(128),\n  `phone`         VARCHAR(32),\n  `email`         VARCHAR(320),\n  `address`       TEXT,\n  `isActive`      BOOLEAN NOT NULL DEFAULT TRUE,\n  `createdAt`     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── PRODUCTS ────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `products` (\n  `id`           INT AUTO_INCREMENT PRIMARY KEY,\n  `sku`          VARCHAR(64)  NOT NULL UNIQUE,\n  `name`         VARCHAR(256) NOT NULL,\n  `description`  TEXT,\n  `categoryId`   INT,\n  `supplierId`   INT,\n  `landingCost`  DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `branchCost`   DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `retailPrice`  DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `reorderLevel` INT NOT NULL DEFAULT 5,\n  `isActive`     BOOLEAN NOT NULL DEFAULT TRUE,\n  `imageUrl`     TEXT,\n  `barcode`      VARCHAR(128),\n  `createdAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_prod_category` FOREIGN KEY (`categoryId`) REFERENCES `categories`(`id`) ON DELETE SET NULL,\n  CONSTRAINT `fk_prod_supplier` FOREIGN KEY (`supplierId`) REFERENCES `suppliers`(`id`)  ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── INVENTORY ITEMS ─────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `inventory_items` (\n  `id`                INT AUTO_INCREMENT PRIMARY KEY,\n  `serialNo`          VARCHAR(128) NOT NULL UNIQUE,\n  `batchId`           VARCHAR(64),\n  `productId`         INT NOT NULL,\n  `branchId`          INT NOT NULL,\n  `landingCost`       DECIMAL(12,2) NOT NULL,\n  `branchCost`        DECIMAL(12,2) NOT NULL,\n  `status`            ENUM('Available','Sold','InTransit','Reserved','Damaged') NOT NULL DEFAULT 'Available',\n  `transitToBranchId` INT,\n  `notes`             TEXT,\n  `createdAt`         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_inv_product` FOREIGN KEY (`productId`) REFERENCES `products`(`id`) ON DELETE CASCADE,\n  CONSTRAINT `fk_inv_branch`  FOREIGN KEY (`branchId`)  REFERENCES `branches`(`id`) ON DELETE CASCADE,\n  INDEX `idx_inv_branch` (`branchId`),\n  INDEX `idx_inv_product` (`productId`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── SALES ───────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `sales` (\n  `id`             INT AUTO_INCREMENT PRIMARY KEY,\n  `receiptNo`      VARCHAR(32) NOT NULL UNIQUE,\n  `branchId`       INT NOT NULL,\n  `userId`         INT NOT NULL,\n  `customerName`   VARCHAR(128),\n  `customerPhone`  VARCHAR(32),\n  `subtotal`       DECIMAL(12,2) NOT NULL,\n  `discount`       DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `totalAmount`    DECIMAL(12,2) NOT NULL,\n  `paymentType`    ENUM('Cash','Card','Transfer','Mixed') NOT NULL,\n  `status`         ENUM('Completed','Voided','Pending') NOT NULL DEFAULT 'Completed',\n  `notes`          TEXT,\n  `syncedAt`       TIMESTAMP,\n  `isOfflineSale`  BOOLEAN NOT NULL DEFAULT FALSE,\n  `createdAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_sale_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_sale_user`   FOREIGN KEY (`userId`)   REFERENCES `users`(`id`)    ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── SALE LINE ITEMS ─────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `sale_items` (\n  `id`              INT AUTO_INCREMENT PRIMARY KEY,\n  `saleId`          INT NOT NULL,\n  `inventoryItemId` INT NOT NULL,\n  `productId`       INT NOT NULL,\n  `serialNo`        VARCHAR(128) NOT NULL,\n  `landingCost`     DECIMAL(12,2) NOT NULL,\n  `branchCost`      DECIMAL(12,2) NOT NULL,\n  `retailPrice`     DECIMAL(12,2) NOT NULL,\n  `profit`          DECIMAL(12,2) NOT NULL,\n  `investor70`      DECIMAL(12,2) NOT NULL,\n  `master30`        DECIMAL(12,2) NOT NULL,\n  `cashDueHO`       DECIMAL(12,2) NOT NULL,\n  `createdAt`       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_si_sale` FOREIGN KEY (`saleId`) REFERENCES `sales`(`id`) ON DELETE CASCADE,\n  CONSTRAINT `fk_si_inv`  FOREIGN KEY (`inventoryItemId`) REFERENCES `inventory_items`(`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── STOCK TRANSFERS ─────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `stock_transfers` (\n  `id`                INT AUTO_INCREMENT PRIMARY KEY,\n  `transferNo`        VARCHAR(32) NOT NULL UNIQUE,\n  `fromBranchId`      INT NOT NULL,\n  `toBranchId`        INT NOT NULL,\n  `requestedByUserId` INT NOT NULL,\n  `approvedByUserId`  INT,\n  `status`            ENUM('Pending','Approved','Rejected','InTransit','Completed','Cancelled') NOT NULL DEFAULT 'Pending',\n  `notes`             TEXT,\n  `rejectionReason`   TEXT,\n  `requestedAt`       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `approvedAt`        TIMESTAMP,\n  `completedAt`       TIMESTAMP,\n  `updatedAt`         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_st_from`      FOREIGN KEY (`fromBranchId`)      REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_st_to`        FOREIGN KEY (`toBranchId`)        REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_st_req_user`  FOREIGN KEY (`requestedByUserId`) REFERENCES `users`(`id`)    ON DELETE RESTRICT,\n  CONSTRAINT `fk_st_app_user`  FOREIGN KEY (`approvedByUserId`)  REFERENCES `users`(`id`)    ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── STOCK TRANSFER ITEMS ────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `stock_transfer_items` (\n  `id`              INT AUTO_INCREMENT PRIMARY KEY,\n  `transferId`      INT NOT NULL,\n  `inventoryItemId` INT NOT NULL,\n  `serialNo`        VARCHAR(128) NOT NULL,\n  `productId`       INT NOT NULL,\n  `createdAt`       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_sti_transfer` FOREIGN KEY (`transferId`) REFERENCES `stock_transfers`(`id`) ON DELETE CASCADE,\n  CONSTRAINT `fk_sti_inv`      FOREIGN KEY (`inventoryItemId`) REFERENCES `inventory_items`(`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── LEDGER ENTRIES ──────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `ledger_entries` (\n  `id`             INT AUTO_INCREMENT PRIMARY KEY,\n  `branchId`       INT NOT NULL,\n  `entryType`      ENUM('Sale','Expense','Payment','Adjustment','Transfer','PurchasePayable') NOT NULL,\n  `referenceId`    INT,\n  `referenceType`  VARCHAR(32),\n  `description`    TEXT,\n  `debit`          DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `credit`         DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `runningBalance` DECIMAL(12,2) NOT NULL,\n  `createdAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_le_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── EXPENSES ────────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `expenses` (\n  `id`          INT AUTO_INCREMENT PRIMARY KEY,\n  `branchId`    INT NOT NULL,\n  `userId`      INT NOT NULL,\n  `category`    VARCHAR(64) NOT NULL,\n  `description` TEXT,\n  `amount`      DECIMAL(12,2) NOT NULL,\n  `expenseDate` TIMESTAMP NOT NULL,\n  `createdAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_exp_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_exp_user`   FOREIGN KEY (`userId`)   REFERENCES `users`(`id`)    ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── PAYMENTS TO HEAD OFFICE ─────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `ho_payments` (\n  `id`            INT AUTO_INCREMENT PRIMARY KEY,\n  `branchId`      INT NOT NULL,\n  `userId`        INT NOT NULL,\n  `amount`        DECIMAL(12,2) NOT NULL,\n  `paymentMethod` VARCHAR(32),\n  `reference`     VARCHAR(128),\n  `notes`         TEXT,\n  `paymentDate`   TIMESTAMP NOT NULL,\n  `createdAt`     TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_hop_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_hop_user`   FOREIGN KEY (`userId`)   REFERENCES `users`(`id`)    ON DELETE RESTRICT\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── BRANCH LEDGER ENTRIES ───────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `branch_ledger_entries` (\n  `id`          INT AUTO_INCREMENT PRIMARY KEY,\n  `branchId`    INT NOT NULL,\n  `saleId`      INT,\n  `type`        ENUM('stock_received','sale_profit','payment_sent','payment_received') NOT NULL,\n  `amount`      DECIMAL(12,2) NOT NULL,\n  `description` TEXT,\n  `createdAt`   TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_ble_branch` FOREIGN KEY (`branchId`) REFERENCES `branches`(`id`) ON DELETE RESTRICT,\n  CONSTRAINT `fk_ble_sale`   FOREIGN KEY (`saleId`)   REFERENCES `sales`(`id`)    ON DELETE SET NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── AUDIT TRAIL ─────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `audit_logs` (\n  `id`         BIGINT AUTO_INCREMENT PRIMARY KEY,\n  `userId`     INT,\n  `userEmail`  VARCHAR(320),\n  `userName`   VARCHAR(128),\n  `action`     VARCHAR(64) NOT NULL,\n  `entityType` VARCHAR(64) NOT NULL,\n  `entityId`   VARCHAR(64),\n  `branchId`   INT,\n  `details`    TEXT,\n  `ipAddress`  VARCHAR(64),\n  `createdAt`  TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  INDEX `idx_audit_entity` (`entityType`, `entityId`),\n  INDEX `idx_audit_user` (`userId`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── COMPANY SETTINGS ────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `company_settings` (\n  `id`              INT AUTO_INCREMENT PRIMARY KEY,\n  `companyName`     VARCHAR(256) NOT NULL DEFAULT 'AutoTools ERP',\n  `tagline`         VARCHAR(256),\n  `address`         TEXT,\n  `phone`           VARCHAR(64),\n  `email`           VARCHAR(320),\n  `website`         VARCHAR(256),\n  `currency`        VARCHAR(8) NOT NULL DEFAULT 'USD',\n  `currencySymbol`  VARCHAR(8) NOT NULL DEFAULT '$',\n  `logoUrl`         TEXT,\n  `primaryColor`    VARCHAR(32) DEFAULT '#f97316',\n  `taxRate`         DECIMAL(5,2) DEFAULT 0.00,\n  `receiptFooter`   TEXT,\n  `updatedAt`       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── CUSTOMERS ───────────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `customers` (\n  `id`             INT AUTO_INCREMENT PRIMARY KEY,\n  `name`           VARCHAR(128) NOT NULL,\n  `phone`          VARCHAR(32),\n  `email`          VARCHAR(320),\n  `address`        TEXT,\n  `notes`          TEXT,\n  `totalPurchases` DECIMAL(12,2) NOT NULL DEFAULT 0.00,\n  `isActive`       BOOLEAN NOT NULL DEFAULT TRUE,\n  `createdAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`      TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n-- ─── REORDER ALERTS ──────────────────────────────────────────────────────────\nCREATE TABLE IF NOT EXISTS `reorder_alerts` (\n  `id`           INT AUTO_INCREMENT PRIMARY KEY,\n  `productId`    INT NOT NULL,\n  `branchId`     INT NOT NULL,\n  `currentStock` INT NOT NULL,\n  `reorderLevel` INT NOT NULL,\n  `isResolved`   BOOLEAN NOT NULL DEFAULT FALSE,\n  `resolvedAt`   TIMESTAMP,\n  `createdAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt`    TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  CONSTRAINT `fk_ra_product` FOREIGN KEY (`productId`) REFERENCES `products`(`id`) ON DELETE CASCADE,\n  CONSTRAINT `fk_ra_branch`  FOREIGN KEY (`branchId`)  REFERENCES `branches`(`id`) ON DELETE CASCADE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 2775
}